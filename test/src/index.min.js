import{types as tt}from"./tokentype.js";import{Parser}from"./state.js";import{lineBreak,skipWhiteSpace}from"./whitespace.js";import{isIdentifierStart,isIdentifierChar,keywordRelationalOperator}from"./identifier.js";import{hasOwn,loneSurrogate}from"./util.js";import{DestructuringErrors}from"./parseutil.js";import{functionFlags,SCOPE_SIMPLE_CATCH,BIND_SIMPLE_CATCH,BIND_LEXICAL,BIND_VAR,BIND_FUNCTION,SCOPE_CLASS_STATIC_BLOCK,SCOPE_SUPER}from"./scopeflags.js";const pp=Parser.prototype;pp.parseTopLevel=function(t){let e=Object.create(null);for(t.body||(t.body=[]);this.type!==tt.eof;){let s=this.parseStatement(null,!0,e);t.body.push(s)}if(this.inModule)for(let t of Object.keys(this.undefinedExports))this.raiseRecoverable(this.undefinedExports[t].start,`Export '${t}' is not defined`);return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};const loopLabel={kind:"loop"},switchLabel={kind:"switch"};pp.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;skipWhiteSpace.lastIndex=this.pos;let e=skipWhiteSpace.exec(this.input),s=this.pos+e[0].length,i=this.input.charCodeAt(s);if(91===i||92===i||i>55295&&i<56320)return!0;if(t)return!1;if(123===i)return!0;if(isIdentifierStart(i,!0)){let t=s+1;for(;isIdentifierChar(i=this.input.charCodeAt(t),!0);)++t;if(92===i||i>55295&&i<56320)return!0;let e=this.input.slice(s,t);if(!keywordRelationalOperator.test(e))return!0}return!1},pp.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;skipWhiteSpace.lastIndex=this.pos;let t,e=skipWhiteSpace.exec(this.input),s=this.pos+e[0].length;return!(lineBreak.test(this.input.slice(this.pos,s))||"function"!==this.input.slice(s,s+8)||s+8!==this.input.length&&(isIdentifierChar(t=this.input.charCodeAt(s+8))||t>55295&&t<56320))},pp.parseStatement=function(t,e,s){let i,a=this.type,r=this.startNode();switch(this.isLet(t)&&(a=tt._var,i="let"),a){case tt._break:case tt._continue:return this.parseBreakContinueStatement(r,a.keyword);case tt._debugger:return this.parseDebuggerStatement(r);case tt._do:return this.parseDoStatement(r);case tt._for:return this.parseForStatement(r);case tt._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(r,!1,!t);case tt._class:return t&&this.unexpected(),this.parseClass(r,!0);case tt._if:return this.parseIfStatement(r);case tt._return:return this.parseReturnStatement(r);case tt._switch:return this.parseSwitchStatement(r);case tt._throw:return this.parseThrowStatement(r);case tt._try:return this.parseTryStatement(r);case tt._const:case tt._var:return i=i||this.value,t&&"var"!==i&&this.unexpected(),this.parseVarStatement(r,i);case tt._while:return this.parseWhileStatement(r);case tt._with:return this.parseWithStatement(r);case tt.braceL:return this.parseBlock(!0,r);case tt.semi:return this.parseEmptyStatement(r);case tt._export:case tt._import:if(this.options.ecmaVersion>10&&a===tt._import){skipWhiteSpace.lastIndex=this.pos;let t=skipWhiteSpace.exec(this.input),e=this.pos+t[0].length,s=this.input.charCodeAt(e);if(40===s||46===s)return this.parseExpressionStatement(r,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),a===tt._import?this.parseImport(r):this.parseExport(r,s);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(r,!0,!t);let n=this.value,o=this.parseExpression();return a===tt.name&&"Identifier"===o.type&&this.eat(tt.colon)?this.parseLabeledStatement(r,n,o,t):this.parseExpressionStatement(r,o)}},pp.parseBreakContinueStatement=function(t,e){let s="break"===e;this.next(),this.eat(tt.semi)||this.insertSemicolon()?t.label=null:this.type!==tt.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());let i=0;for(;i<this.labels.length;++i){let e=this.labels[i];if(null==t.label||e.name===t.label.name){if(null!=e.kind&&(s||"loop"===e.kind))break;if(t.label&&s)break}}return i===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,s?"BreakStatement":"ContinueStatement")},pp.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},pp.parseDoStatement=function(t){return this.next(),this.labels.push(loopLabel),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(tt._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(tt.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},pp.parseForStatement=function(t){this.next();let e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(loopLabel),this.enterScope(0),this.expect(tt.parenL),this.type===tt.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);let s=this.isLet();if(this.type===tt._var||this.type===tt._const||s){let i=this.startNode(),a=s?"let":this.value;return this.next(),this.parseVar(i,!0,a),this.finishNode(i,"VariableDeclaration"),(this.type===tt._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===i.declarations.length?(this.options.ecmaVersion>=9&&(this.type===tt._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,i)):(e>-1&&this.unexpected(e),this.parseFor(t,i))}let i=this.isContextual("let"),a=!1,r=new DestructuringErrors,n=this.parseExpression(!(e>-1)||"await",r);return this.type===tt._in||(a=this.options.ecmaVersion>=6&&this.isContextual("of"))?(this.options.ecmaVersion>=9&&(this.type===tt._in?e>-1&&this.unexpected(e):t.await=e>-1),i&&a&&this.raise(n.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(n,!1,r),this.checkLValPattern(n),this.parseForIn(t,n)):(this.checkExpressionErrors(r,!0),e>-1&&this.unexpected(e),this.parseFor(t,n))},pp.parseFunctionStatement=function(t,e,s){return this.next(),this.parseFunction(t,FUNC_STATEMENT|(s?0:FUNC_HANGING_STATEMENT),!1,e)},pp.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(tt._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},pp.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(tt.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},pp.parseSwitchStatement=function(t){let e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(tt.braceL),this.labels.push(switchLabel),this.enterScope(0);for(let s=!1;this.type!==tt.braceR;)if(this.type===tt._case||this.type===tt._default){let i=this.type===tt._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),i?e.test=this.parseExpression():(s&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),s=!0,e.test=null),this.expect(tt.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},pp.parseThrowStatement=function(t){return this.next(),lineBreak.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};const empty=[];pp.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===tt._catch){let e=this.startNode();if(this.next(),this.eat(tt.parenL)){e.param=this.parseBindingAtom();let t="Identifier"===e.param.type;this.enterScope(t?SCOPE_SIMPLE_CATCH:0),this.checkLValPattern(e.param,t?BIND_SIMPLE_CATCH:BIND_LEXICAL),this.expect(tt.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(tt._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},pp.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},pp.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(loopLabel),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},pp.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},pp.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},pp.parseLabeledStatement=function(t,e,s,i){for(let t of this.labels)t.name===e&&this.raise(s.start,"Label '"+e+"' is already declared");let a=this.type.isLoop?"loop":this.type===tt._switch?"switch":null;for(let e=this.labels.length-1;e>=0;e--){let s=this.labels[e];if(s.statementStart!==t.start)break;s.statementStart=this.start,s.kind=a}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(i?-1===i.indexOf("label")?i+"label":i:"label"),this.labels.pop(),t.label=s,this.finishNode(t,"LabeledStatement")},pp.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},pp.parseBlock=function(t=!0,e=this.startNode(),s){for(e.body=[],this.expect(tt.braceL),t&&this.enterScope(0);this.type!==tt.braceR;){let t=this.parseStatement(null);e.body.push(t)}return s&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")},pp.parseFor=function(t,e){return t.init=e,this.expect(tt.semi),t.test=this.type===tt.semi?null:this.parseExpression(),this.expect(tt.semi),t.update=this.type===tt.parenR?null:this.parseExpression(),this.expect(tt.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},pp.parseForIn=function(t,e){const s=this.type===tt._in;return this.next(),"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(!s||this.options.ecmaVersion<8||this.strict||"var"!==e.kind||"Identifier"!==e.declarations[0].id.type)&&this.raise(e.start,(s?"for-in":"for-of")+" loop variable declaration may not have an initializer"),t.left=e,t.right=s?this.parseExpression():this.parseMaybeAssign(),this.expect(tt.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,s?"ForInStatement":"ForOfStatement")},pp.parseVar=function(t,e,s){for(t.declarations=[],t.kind=s;;){let i=this.startNode();if(this.parseVarId(i,s),this.eat(tt.eq)?i.init=this.parseMaybeAssign(e):"const"!==s||this.type===tt._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===i.id.type||e&&(this.type===tt._in||this.isContextual("of"))?i.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(i,"VariableDeclarator")),!this.eat(tt.comma))break}return t},pp.parseVarId=function(t,e){t.id=this.parseBindingAtom(),this.checkLValPattern(t.id,"var"===e?BIND_VAR:BIND_LEXICAL,!1)};const FUNC_STATEMENT=1,FUNC_HANGING_STATEMENT=2,FUNC_NULLABLE_ID=4;function isPrivateNameConflicted(t,e){const s=e.key.name,i=t[s];let a="true";return"MethodDefinition"!==e.type||"get"!==e.kind&&"set"!==e.kind||(a=(e.static?"s":"i")+e.kind),"iget"===i&&"iset"===a||"iset"===i&&"iget"===a||"sget"===i&&"sset"===a||"sset"===i&&"sget"===a?(t[s]="true",!1):!!i||(t[s]=a,!1)}function checkKeyName(t,e){const{computed:s,key:i}=t;return!s&&("Identifier"===i.type&&i.name===e||"Literal"===i.type&&i.value===e)}pp.parseFunction=function(t,e,s,i,a){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===tt.star&&e&FUNC_HANGING_STATEMENT&&this.unexpected(),t.generator=this.eat(tt.star)),this.options.ecmaVersion>=8&&(t.async=!!i),e&FUNC_STATEMENT&&(t.id=4&e&&this.type!==tt.name?null:this.parseIdent(),!t.id||e&FUNC_HANGING_STATEMENT||this.checkLValSimple(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?BIND_VAR:BIND_LEXICAL:BIND_FUNCTION));let r=this.yieldPos,n=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(functionFlags(t.async,t.generator)),e&FUNC_STATEMENT||(t.id=this.type===tt.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,s,!1,a),this.yieldPos=r,this.awaitPos=n,this.awaitIdentPos=o,this.finishNode(t,e&FUNC_STATEMENT?"FunctionDeclaration":"FunctionExpression")},pp.parseFunctionParams=function(t){this.expect(tt.parenL),t.params=this.parseBindingList(tt.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},pp.parseClass=function(t,e){this.next();const s=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);const i=this.enterClassBody(),a=this.startNode();let r=!1;for(a.body=[],this.expect(tt.braceL);this.type!==tt.braceR;){const e=this.parseClassElement(null!==t.superClass);e&&(a.body.push(e),"MethodDefinition"===e.type&&"constructor"===e.kind?(r&&this.raise(e.start,"Duplicate constructor in the same class"),r=!0):e.key&&"PrivateIdentifier"===e.key.type&&isPrivateNameConflicted(i,e)&&this.raiseRecoverable(e.key.start,`Identifier '#${e.key.name}' has already been declared`))}return this.strict=s,this.next(),t.body=this.finishNode(a,"ClassBody"),this.exitClassBody(),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},pp.parseClassElement=function(t){if(this.eat(tt.semi))return null;const e=this.options.ecmaVersion,s=this.startNode();let i="",a=!1,r=!1,n="method",o=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(tt.braceL))return this.parseClassStaticBlock(s),s;this.isClassElementNameStart()||this.type===tt.star?o=!0:i="static"}if(s.static=o,!i&&e>=8&&this.eatContextual("async")&&(!this.isClassElementNameStart()&&this.type!==tt.star||this.canInsertSemicolon()?i="async":r=!0),!i&&(e>=9||!r)&&this.eat(tt.star)&&(a=!0),!i&&!r&&!a){const t=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?n=t:i=t)}if(i?(s.computed=!1,s.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),s.key.name=i,this.finishNode(s.key,"Identifier")):this.parseClassElementName(s),e<13||this.type===tt.parenL||"method"!==n||a||r){const e=!s.static&&checkKeyName(s,"constructor"),i=e&&t;e&&"method"!==n&&this.raise(s.key.start,"Constructor can't have get/set modifier"),s.kind=e?"constructor":n,this.parseClassMethod(s,a,r,i)}else this.parseClassField(s);return s},pp.isClassElementNameStart=function(){return this.type===tt.name||this.type===tt.privateId||this.type===tt.num||this.type===tt.string||this.type===tt.bracketL||this.type.keyword},pp.parseClassElementName=function(t){this.type===tt.privateId?("constructor"===this.value&&this.raise(this.start,"Classes can't have an element named '#constructor'"),t.computed=!1,t.key=this.parsePrivateIdent()):this.parsePropertyName(t)},pp.parseClassMethod=function(t,e,s,i){const a=t.key;"constructor"===t.kind?(e&&this.raise(a.start,"Constructor can't be a generator"),s&&this.raise(a.start,"Constructor can't be an async method")):t.static&&checkKeyName(t,"prototype")&&this.raise(a.start,"Classes may not have a static property named prototype");const r=t.value=this.parseMethod(e,s,i);return"get"===t.kind&&0!==r.params.length&&this.raiseRecoverable(r.start,"getter should have no params"),"set"===t.kind&&1!==r.params.length&&this.raiseRecoverable(r.start,"setter should have exactly one param"),"set"===t.kind&&"RestElement"===r.params[0].type&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(t,"MethodDefinition")},pp.parseClassField=function(t){if(checkKeyName(t,"constructor")?this.raise(t.key.start,"Classes can't have a field named 'constructor'"):t.static&&checkKeyName(t,"prototype")&&this.raise(t.key.start,"Classes can't have a static field named 'prototype'"),this.eat(tt.eq)){const e=this.currentThisScope(),s=e.inClassFieldInit;e.inClassFieldInit=!0,t.value=this.parseMaybeAssign(),e.inClassFieldInit=s}else t.value=null;return this.semicolon(),this.finishNode(t,"PropertyDefinition")},pp.parseClassStaticBlock=function(t){t.body=[];let e=this.labels;for(this.labels=[],this.enterScope(SCOPE_CLASS_STATIC_BLOCK|SCOPE_SUPER);this.type!==tt.braceR;){let e=this.parseStatement(null);t.body.push(e)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(t,"StaticBlock")},pp.parseClassId=function(t,e){this.type===tt.name?(t.id=this.parseIdent(),e&&this.checkLValSimple(t.id,BIND_LEXICAL,!1)):(!0===e&&this.unexpected(),t.id=null)},pp.parseClassSuper=function(t){t.superClass=this.eat(tt._extends)?this.parseExprSubscripts(!1):null},pp.enterClassBody=function(){const t={declared:Object.create(null),used:[]};return this.privateNameStack.push(t),t.declared},pp.exitClassBody=function(){const{declared:t,used:e}=this.privateNameStack.pop(),s=this.privateNameStack.length,i=0===s?null:this.privateNameStack[s-1];for(let s=0;s<e.length;++s){const a=e[s];hasOwn(t,a.name)||(i?i.used.push(a):this.raiseRecoverable(a.start,`Private field '#${a.name}' must be declared in an enclosing class`))}},pp.parseExport=function(t,e){if(this.next(),this.eat(tt.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseModuleExportName(),this.checkExport(e,t.exported,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==tt.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(tt._default)){let s;if(this.checkExport(e,"default",this.lastTokStart),this.type===tt._function||(s=this.isAsyncFunction())){let e=this.startNode();this.next(),s&&this.next(),t.declaration=this.parseFunction(e,4|FUNC_STATEMENT,!1,s)}else if(this.type===tt._class){let e=this.startNode();t.declaration=this.parseClass(e,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(null),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==tt.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(let e of t.specifiers)this.checkUnreserved(e.local),this.checkLocalExport(e.local),"Literal"===e.local.type&&this.raise(e.local.start,"A string literal cannot be used as an exported binding without `from`.");t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},pp.checkExport=function(t,e,s){t&&("string"!=typeof e&&(e="Identifier"===e.type?e.name:e.value),hasOwn(t,e)&&this.raiseRecoverable(s,"Duplicate export '"+e+"'"),t[e]=!0)},pp.checkPatternExport=function(t,e){let s=e.type;if("Identifier"===s)this.checkExport(t,e,e.start);else if("ObjectPattern"===s)for(let s of e.properties)this.checkPatternExport(t,s);else if("ArrayPattern"===s)for(let s of e.elements)s&&this.checkPatternExport(t,s);else"Property"===s?this.checkPatternExport(t,e.value):"AssignmentPattern"===s?this.checkPatternExport(t,e.left):"RestElement"===s?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===s&&this.checkPatternExport(t,e.expression)},pp.checkVariableExport=function(t,e){if(t)for(let s of e)this.checkPatternExport(t,s.id)},pp.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},pp.parseExportSpecifiers=function(t){let e=[],s=!0;for(this.expect(tt.braceL);!this.eat(tt.braceR);){if(s)s=!1;else if(this.expect(tt.comma),this.afterTrailingComma(tt.braceR))break;let i=this.startNode();i.local=this.parseModuleExportName(),i.exported=this.eatContextual("as")?this.parseModuleExportName():i.local,this.checkExport(t,i.exported,i.exported.start),e.push(this.finishNode(i,"ExportSpecifier"))}return e},pp.parseImport=function(t){return this.next(),this.type===tt.string?(t.specifiers=empty,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===tt.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},pp.parseImportSpecifiers=function(){let t=[],e=!0;if(this.type===tt.name){let e=this.startNode();if(e.local=this.parseIdent(),this.checkLValSimple(e.local,BIND_LEXICAL),t.push(this.finishNode(e,"ImportDefaultSpecifier")),!this.eat(tt.comma))return t}if(this.type===tt.star){let e=this.startNode();return this.next(),this.expectContextual("as"),e.local=this.parseIdent(),this.checkLValSimple(e.local,BIND_LEXICAL),t.push(this.finishNode(e,"ImportNamespaceSpecifier")),t}for(this.expect(tt.braceL);!this.eat(tt.braceR);){if(e)e=!1;else if(this.expect(tt.comma),this.afterTrailingComma(tt.braceR))break;let s=this.startNode();s.imported=this.parseModuleExportName(),this.eatContextual("as")?s.local=this.parseIdent():(this.checkUnreserved(s.imported),s.local=s.imported),this.checkLValSimple(s.local,BIND_LEXICAL),t.push(this.finishNode(s,"ImportSpecifier"))}return t},pp.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===tt.string){const t=this.parseLiteral(this.value);return loneSurrogate.test(t.value)&&this.raise(t.start,"An export name cannot include a lone surrogate."),t}return this.parseIdent(!0)},pp.adaptDirectivePrologue=function(t){for(let e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},pp.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};
